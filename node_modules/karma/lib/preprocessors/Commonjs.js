var log = require('../logger').create('preprocess.commonjs');

var CommonJS = function(content, file, basePath, done) {
  log.debug('Processing "%s".', file.originalPath);

	var output =
		"window.__karma__.CJSModules = window.__karma__.CJSModules || {};" +
		"window.__karma__.CJSModules['" + file.originalPath + "'] = function(require, module) {" +
			"var exports = module.exports;" +
			content +
//			"window.__karma__.CJSModules['" + file.originalPath + "'] = module;" +
		"}";
//			"(window.__karma__.CJSRequire, { exports: {} }));"
//		"dump('" + file + ": ' + module.exports);";

	done(output);

//  file.path = file.originalPath + '-compiled.js';
//
//  var processed = null;
//  try {
//    processed = coffee.compile(content, {bare: true});
//  } catch (e) {
//    log.error('%s\n  at %s', e.message, file.originalPath);
//  }
};

// PUBLISH
module.exports = CommonJS;
